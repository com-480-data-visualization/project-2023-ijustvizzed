<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">
<head>
<script src="https://d3js.org/d3.v6.js"></script>
</head>
<body>

<div id="ohwow">
	bella
</div>

<script>
(async function () {
data = await d3.json("dataset.json");
console.log(data["matrix"]);


matrix = data["matrix"];



	innerRadius = 400
	outerRadius = 406
	textRadius = 406
	width = 840
	height = 840

	formatValue = x => `${x.toFixed(0)}B`

	color = d3.scaleOrdinal(data["labels"], d3.schemeCategory10)

	chord = d3.chordDirected()
    .padAngle(12 / innerRadius)
    .sortSubgroups(d3.descending)
    .sortChords(d3.descending)

	const chords = chord(matrix);

	arc = d3.arc()
    .innerRadius(innerRadius)
    .outerRadius(outerRadius)

	ribbon = d3.ribbonArrow()
    .radius(innerRadius - 0.5)
    .padAngle(1 / innerRadius)

  const textId_id = "mytext";
	const textId_href = "#mytext";

	  const svg = d3.create("svg")
      .attr("viewBox", [-width / 2, -height / 2, width, height]);

	console.log(outerRadius)

  svg.append("path")
      .attr("id", textId_id)
      .attr("fill", "none")
      .attr("d", d3.arc()({outerRadius: textRadius, startAngle: 0, endAngle: 2 * Math.PI}));

  svg.append("g")
      .attr("fill-opacity", 0.25)
    .selectAll("g")
    .data(chords)
    .join("path")
      .attr("d", ribbon)
      .attr("fill", d => color(data["labels"][d.target.index]))
      .style("mix-blend-mode", "multiply")
    .append("title")
      .text(d => `${data["labels"][d.source.index]} owes ${data["labels"][d.target.index]} ${formatValue(d.source.value)}`);

  svg.append("g")
      .attr("font-family", "sans-serif")
      .attr("font-size", 15)
    .selectAll("g")
    .data(chords.groups)
    .join("g")
      .call(g => g.append("path")
        .attr("d", arc)
        .attr("fill", d => color(data["labels"][d.index]))
        .attr("stroke", "#fff"))
      .call(g => g.append("text")
        .attr("dy", -3)
      .append("textPath")
        .attr("href", textId_href)
        .attr("startOffset", d => d.startAngle * outerRadius)
        .text(d => data["labels"][d.index]))
      .call(g => g.append("title")
        .text(d => `${data["labels"][d.index]}
owes ${formatValue(d3.sum(matrix[d.index]))}
is owed ${formatValue(d3.sum(matrix, row => row[d.index]))}`));

	document.getElementById("ohwow").appendChild(svg.node());

// to add interactivity: https://d3-graph-gallery.com/graph/chord_interactive.html

})();
</script>



</body>
